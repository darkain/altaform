<?php


////////////////////////////////////////////////////////////////////////////////
//VERIFY WE HAVE A BRANCH SELECTED
////////////////////////////////////////////////////////////////////////////////
assert500(
	!empty($af->config->github['branch']),
	'No GitHub branch has been defined - $afconfig["github"]["branch"]'
);




////////////////////////////////////////////////////////////////////////////////
//VERIFY WE HAVE A BRANCH SELECTED
////////////////////////////////////////////////////////////////////////////////
assert500(
	!empty($af->config->github['path']),
	'No local git repository path specified - $afconfig["github"]["path"]'
);




////////////////////////////////////////////////////////////////////////////////
//SET THE CONTENT TYPE TO TEXT
////////////////////////////////////////////////////////////////////////////////
$af->contentType('txt');




////////////////////////////////////////////////////////////////////////////////
//PULL THE BRANCH AND SUBMODULES
////////////////////////////////////////////////////////////////////////////////
chdir($af->config->github['path']);

$commands = [
	'pwd',
	'whoami',
	'git stash',
	'git pull origin ' . $af->config->github['branch'],
	'git status',
	'git submodule init',
	'git submodule update',
	'git submodule status',
];

foreach ($commands as $command) {
	echo '> ' . $command . "\n";
	echo rtrim(shell_exec($command . ' 2>&1')) . "\n\n";
}
